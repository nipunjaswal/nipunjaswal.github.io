<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="Nipun Jaswal">
<meta name="description"
    content="If you think i am lazy with my posts, Hell Yeah! you are absolutely correct. Sometimes I feel 24-hours in a day are just not enough. I have ton of things to care about in life, things such as my family and my work, my friends who are like my family. I delivered my last session on 10th (if i remember correctly) in my very own Alma mater i.e. Lovely professional university and it was a great experience as always." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/2017/11/postpone-your-marriage-plans-and-deal-with-the-hack-first/" />


<title>
    
    Postpone your Marriage plans and Deal with the Hack first :: VAPT.IO - Home of the Next Gen Cyber Ninja  — Learn Vulnerability Assessment and Penetration Testing
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.7bfbbe12786fa0ded4b4c0d792cbb36a5bd0bdb0b856dde57aa7b1f6fe0f2b87.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="Postpone your Marriage plans and Deal with the Hack first">
<meta itemprop="description" content="If you think i am lazy with my posts, Hell Yeah! you are absolutely correct. Sometimes I feel 24-hours in a day are just not enough. I have ton of things to care about in life, things such as my family and my work, my friends who are like my family. I delivered my last session on 10th (if i remember correctly) in my very own Alma mater i.e. Lovely professional university and it was a great experience as always.">


<meta itemprop="datePublished" content="2017-11-30T23:46:00&#43;05:30" />
<meta itemprop="dateModified" content="2017-11-30T23:46:00&#43;05:30" />
<meta itemprop="wordCount" content="856">



<meta itemprop="keywords" content="dll hijacking,antivirus evasion,the backdoor factory,dll search order hijacking,bypassing antivirus," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Postpone your Marriage plans and Deal with the Hack first"/>
<meta name="twitter:description" content="If you think i am lazy with my posts, Hell Yeah! you are absolutely correct. Sometimes I feel 24-hours in a day are just not enough. I have ton of things to care about in life, things such as my family and my work, my friends who are like my family. I delivered my last session on 10th (if i remember correctly) in my very own Alma mater i.e. Lovely professional university and it was a great experience as always."/>




<meta property="article:published_time" content="2017-11-30 23:46:00 &#43;0530 IST" />







    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">ap3x@vapt.io:~# ./hack</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>5 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title"><a href="/posts/2017/11/postpone-your-marriage-plans-and-deal-with-the-hack-first/">Postpone your Marriage plans and Deal with the Hack first</a></h1>

            

            <div class="post-content">
                <p>If you think i am lazy with my posts, Hell Yeah! you are absolutely correct. Sometimes I feel 24-hours in a day are just not enough. I have
ton of things to care about in life, things such as my family and my
work, my friends who are like my family. I delivered my last session on 10th (if i remember correctly) in my very own Alma mater  i.e. Lovely
professional university and it was a great experience as always. Due to the nature of audience(students), i tried keeping a little technical yet
important topic which was <strong>DLL Search Order Hijacking</strong>. The reason
i chose this topic over others is that this may sound interesting yet
simple to the upcoming ninjas of my university.</p>

<p>I have to admit, i keep searching about my books on the internet
everyday, filtering them out through countries and time to check if they
are being leaked anywhere on the internet and what i found one day was
that being an author, i have been indexed by google with a knowledge
graph. However, i felt disappointed seeing my age alongside my name 😞</p>

<p>First time in my life, i felt like if google is pretending to be my
mother who keeps giving me a reality check on the age and marriage
suggestions. Things became worse when some popular matrimonial website
started following me on twitter. Well, finally i made up my mind and
asked my mother to sign up for some popular matrimony sites. Suddenly,
we started receiving ton of calls and what all people required was a
<strong>KUNDLI</strong> (This is a popular Indian document which is more powerful
than all your certifications / Degrees/ Diplomas/ Letter of
Recommendations) i mean this document, as soon as it gets printed
controls your fortune, destiny, karma, sins and what not. If you are
confused and don&rsquo;t have an idea what the hell i am talking about, this
document is related to astrology which is used for match making.</p>

<p>So, we found someone locally who can get this document printed based on
my DOB, place of birth, name etc. Accidentally, the guy who printed was
running the software right in front of my evil eyes which kept staring
at his cracked and no longer supported operating system which is none
other than the legendary Windows XP. I kept looking and thinking about
<strong>ms08_067_netapi</strong> (which made me happy obviously). However, then
popped a software which actually generated the book of my life(Kundli)
and the software was Kundli Pro(Also known as Kundli for Windows).
<p align="center">
<a href="/images/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-kundli.png"><img src="/images/thumbnails/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-kundli.png" alt="" /></a>
</p>
I came back home and downloaded this software from the internet and
started looking for a potential vulnerability. I found some low hanging
BOFs but i wanted to evade any possibilities of suspicion. I fired up my
procmon (Process Monitor) and ran filters on the KUNDLI software as
shown in the following screen:
<p align="center">
<a href="/images/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-procmon.png"><img src="/images/thumbnails/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-procmon.png" alt="" /></a>
</p>
Hmm.. Interesting. If you have no idea what DLL Search order hijacking
is, better get your googling skills into play. Anyways, the software
tries to load the <code>VB5.DLL</code> while running. However, the vulnerability is
that it starts from the current folder. This means it first looks in its
own directory which is located in Program files and then when it doesn&rsquo;t
find one, it goes to the system32 folder and loads it. This means that
if anyhow the software is shipped with the VB5.dll as a package. it will
never load the other one from system32. Next, what we can do is to
simply create a meterpreter backdoor in a <code>.dll</code> format, rename it as
<code>VB5.dll</code> and place it in the software folder and re-run the software as
shown in the following screen:
<p align="center">
<a href="/images/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-dllplace.png"><img src="/images/thumbnails/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-dllplace.png" alt="" /></a>
</p><p align="center">
Re-running the software will provide us with a meterpreter shell.
However, the software will crash which may cause suspicion as shown in
the following screen:
<p align="center">
<a href="/images/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-error.png"><img src="/images/thumbnails/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-error.png" alt="" /></a>
</p>
 At this point what we can do is to simply download the DLL file from
some popular DLL sharing site(Original) and backdoor the original file
though a code cave as shown in the following screen:
<p align="center">
<a href="/images/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-Picture1.png"><img src="/images/thumbnails/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-Picture1.png" alt="" /></a>
</p>
 Let&rsquo;s re-run the software and check if something changed:
<p align="center">
<a href="/images/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-fund.png"><img src="/images/thumbnails/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-fund.png" alt="" /></a>
</p>
We can see that the software loaded the DLL with ease from the current
directory itself. Let&rsquo;s check our meterpreter handler:
<p align="center">
<a href="/images/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-fi.png"><img src="/images/thumbnails/2017-11-30-postpone-your-marriage-plans-and-deal-with-the-hack-first-fi.png" alt="" /></a>
</p>
Bang! we got the access to the target with no suspicion at all.
Achieving this point, i could do ton of things such as:</p>

<ol>
<li>Re-Packing the software with the infected DLL file and distributing
it over the internet</li>
<li>Packing the software with a crypto miner and make tons of cash</li>
<li>Cause harm to the infected people by breaching there privacy</li>
<li>Locking their systems with a ransomware</li>
<li>Ask my matches at JeevanSathi and Shaadi.com to install the software
:P This could have been Fun!!!</li>
</ol>

<p>However, i choose to disclose this vulnerability right here at my blog
and this is the exact reason why you shouldn&rsquo;t use cracked software.
This tutorial was for educational purposes only. Please do not harm
anyone.</p>

<p><strong>References and Tools used:</strong></p>

<ol>
<li><a href="https://github.com/secretsquirrel/the-backdoor-factory" target="_blank">https://github.com/secretsquirrel/the-backdoor-factory</a></li>
<li><a href="https://www.metasploit.com/" target="_blank">https://www.metasploit.com/</a></li>
<li><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procmon" target="_blank">https://docs.microsoft.com/en-us/sysinternals/downloads/procmon</a></li>
<li><a href="https://attack.mitre.org/wiki/Technique/T1038" target="_blank">https://attack.mitre.org/wiki/Technique/T1038</a></li>
<li>Original PPT:
<a href="https://www.slideshare.net/nipunjaswal/hijacking-softwares-for-fun-and-profit" target="_blank">https://www.slideshare.net/nipunjaswal/hijacking-softwares-for-fun-and-profit</a></li>
<li>For Metasploit Tutorials you can buy my books
<a href="https://www.amazon.com/Nipun-Jaswal/e/B00OXOCXOU" target="_blank">here</a> ( This is
self promotion :P, i think i can do that, its my blog right :P)</li>
</ol>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="/tags/dll-hijacking">dll hijacking</a></span><span class="tag"><a href="/tags/antivirus-evasion">antivirus evasion</a></span><span class="tag"><a href="/tags/the-backdoor-factory">the backdoor factory</a></span><span class="tag"><a href="/tags/dll-search-order-hijacking">dll search order hijacking</a></span><span class="tag"><a href="/tags/bypassing-antivirus">bypassing antivirus</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>856 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2017-11-30 23:46 &#43;0530</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="/posts/2018/01/art-of-shellcoding-the-saga-of-bind-tcp-shell/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Art of Shellcoding: The Saga of Bind TCP Shell</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="/posts/2017/08/antivirus-evasion-for-dummies/">
                                <span class="button__text">Antivirus Evasion for dummies</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2019</span>
            
                <span><a href="/">Apex Predator</a></span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4c3fb12a087ceed4a52cb5d57068a9795c7069617a01ca70f788052ad66e1791779e6c72686e1dc0ca13dc03b0203204b6566bb0dd1ee80de2b7ff4d8fe53db2.js" integrity="sha512-TD&#43;xKgh87tSlLLXVcGipeVxwaWF6Acpw94gFKtZuF5F3nmxyaG4dwMoT3AOwIDIEtlZrsN0e6A3it/9Nj&#43;U9sg=="></script>



    </body>
</html>
